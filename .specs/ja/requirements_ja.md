# 要件定義書

## 概要

DockerMCPGatewayをブラウザ上のWEBUIで管理できるツールです。MCPサーバーの一覧表示、詳細確認、設定変更、テスト実行、ログ確認、カタログからのインストール、機密情報管理、設定のインポート/エクスポート、BitwardenCLI連携、認証機能を提供します。

## 要件

### 要件1

**ユーザーストーリー:** 管理者として、インストール済みのMCPサーバーの一覧を確認したい。そうすることで、現在利用可能なMCPサーバーを把握できる。

#### 受入基準

1. WHEN ダッシュボードにアクセスした時 THEN システムは インストール済みMCPサーバーの一覧を表示する
2. WHEN MCPサーバーが追加または削除された時 THEN システムは 一覧を自動的に更新する
3. IF MCPサーバーが実行中の場合 THEN システムは ステータスを「実行中」として表示する
4. IF MCPサーバーが停止中の場合 THEN システムは ステータスを「停止中」として表示する

### 要件2

**ユーザーストーリー:** 管理者として、MCPサーバーの詳細情報を確認したい。そうすることで、利用可能なツールや設定を把握できる。

#### 受入基準

1. WHEN MCPサーバーを選択した時 THEN システムは サーバーの詳細情報を表示する
2. WHEN 詳細画面を表示した時 THEN システムは 利用可能なツール一覧を表示する
3. WHEN 詳細画面を表示した時 THEN システムは サーバーの設定情報を表示する
4. WHEN 詳細画面を表示した時 THEN システムは サーバーのリソース使用状況を表示する

### 要件3

**ユーザーストーリー:** 管理者として、MCPサーバーの設定を変更したい。そうすることで、使用するツールの選択や機密情報を管理できる。

#### 受入基準

1. WHEN 設定画面にアクセスした時 THEN システムは 現在の設定値を表示する
2. WHEN ツール選択を変更した時 THEN システムは 変更を保存し、サーバーに反映する
3. WHEN 機密情報を入力した時 THEN システムは 暗号化して安全に保存する
4. WHEN 設定を保存した時 THEN システムは MCPサーバーを再起動して設定を適用する

### 要件4

**ユーザーストーリー:** 管理者として、MCPサーバーの動作をテストしたい。そうすることで、正常に動作することを確認できる。

#### 受入基準

1. WHEN テスト画面にアクセスした時 THEN システムは 利用可能なツールのテストインターフェースを表示する
2. WHEN ツールを実行した時 THEN システムは 実行結果を表示する
3. WHEN テストが失敗した時 THEN システムは エラー詳細を表示する
4. WHEN テスト履歴を確認した時 THEN システムは 過去のテスト結果を表示する

### 要件5

**ユーザーストーリー:** 管理者として、MCPサーバーのログを確認したい。そうすることで、問題の原因を特定できる。

#### 受入基準

1. WHEN ログ画面にアクセスした時 THEN システムは リアルタイムでログを表示する
2. WHEN ログレベルを選択した時 THEN システムは 指定されたレベル以上のログのみを表示する
3. WHEN ログを検索した時 THEN システムは 検索条件に一致するログを表示する
4. WHEN ログをダウンロードした時 THEN システムは ログファイルを提供する

### 要件6

**ユーザーストーリー:** 管理者として、カタログからMCPサーバーをインストールしたい。そうすることで、新しいMCPサーバーを簡単に追加できる。

#### 受入基準

1. WHEN カタログ画面にアクセスした時 THEN システムは 利用可能なMCPサーバーのカタログを表示する
2. WHEN MCPサーバーを選択した時 THEN システムは サーバーの詳細情報を表示する
3. WHEN インストールボタンをクリックした時 THEN システムは MCPサーバーをインストールする
4. WHEN インストールが完了した時 THEN システムは インストール済み一覧に追加する

### 要件7

**ユーザーストーリー:** 管理者として、機密情報を安全に管理したい。そうすることで、APIキーやトークンを保護できる。

#### 受入基準

1. WHEN 機密情報を入力した時 THEN システムは 暗号化して保存する
2. WHEN 機密情報を表示した時 THEN システムは マスクして表示する
3. WHEN BitwardenCLIが利用可能な場合 THEN システムは Bitwardenから機密情報を取得できる
4. WHEN 機密情報を更新した時 THEN システムは 古い情報を安全に削除する

### 要件8

**ユーザーストーリー:** 管理者として、MCP設定をインポート/エクスポートしたい。そうすることで、設定のバックアップや他環境への移行ができる。

#### 受入基準

1. WHEN エクスポートボタンをクリックした時 THEN システムは MCP設定JSONファイルをダウンロード提供する
2. WHEN インポートファイルを選択した時 THEN システムは ファイルの内容を検証する
3. WHEN 有効な設定ファイルをインポートした時 THEN システムは 設定を適用し、MCPサーバーを更新する
4. WHEN 機密情報を含む設定をエクスポートした時 THEN システムは 機密情報を除外またはマスクする

### 要件9

**ユーザーストーリー:** 管理者として、システムにログインしたい。そうすることで、認証されたユーザーのみがシステムを利用できる。

#### 受入基準

1. WHEN システムにアクセスした時 THEN システムは ログイン画面を表示する
2. WHEN 有効な認証情報を入力した時 THEN システムは ダッシュボードにリダイレクトする
3. WHEN 無効な認証情報を入力した時 THEN システムは エラーメッセージを表示する
4. IF BitwardenCLIが利用可能な場合 THEN システムは Bitwardenの認証情報を使用できる

### 要件10

**ユーザーストーリー:** 開発者として、DockerComposeV2でシステムを起動したい。そうすることで、簡単にローカル環境でシステムを実行できる。

#### 受入基準

1. WHEN `docker compose up`を実行した時 THEN システムは 正常に起動する
2. WHEN システムが起動した時 THEN システムは 指定されたポートでWEBUIにアクセス可能になる
3. WHEN 依存サービスが起動していない時 THEN システムは 適切なエラーメッセージを表示する
4. WHEN システムを停止した時 THEN システムは データを永続化する